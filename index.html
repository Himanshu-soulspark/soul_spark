<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DarePlay - The Ultimate Challenge</title>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS ‡§µ‡§π‡•Ä ‡§π‡•à, ‡§ï‡•ã‡§à ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§®‡§π‡•Ä‡§Ç */
        :root{--primary-color:#FF4848;--secondary-color:#FF8A00;--background-color:#121212;--surface-color:#1E1E1E;--text-color:#FFFFFF;--text-secondary-color:#A9A9A9}
        body{font-family:'Poppins',sans-serif;background-color:var(--background-color);color:var(--text-color);margin:0;padding:0}
        .app-container{max-width:450px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column;padding-bottom:70px}
        .app-header{display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background-color:var(--surface-color);border-bottom:1px solid #333}
        .app-header h1{font-size:1.5em;font-weight:700;background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
        .content{flex-grow:1;overflow-y:auto;padding:20px}
        .page{display:none}.page.active{display:block}
        .btn{display:block;width:100%;padding:15px;border-radius:8px;border:none;font-size:1.1em;font-weight:600;cursor:pointer;text-align:center;transition:transform .2s}.btn:active{transform:scale(.98)}
        .btn-primary{background:linear-gradient(90deg,var(--primary-color),var(--secondary-color));color:var(--text-color)}
        .btn:disabled{background:var(--text-secondary-color);cursor:not-allowed}
        #create-content{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;min-height:calc(100vh - 200px)}
        #generated-dares-form{width:100%;margin-top:20px}
        .dare-block{background-color:var(--surface-color);border:1px solid #333;border-radius:8px;padding:15px;margin-bottom:15px;text-align:left}
        .dare-block p{margin:0 0 10px 0}
        .dare-block strong{color:var(--secondary-color)}
        .dare-block input{width:100%;background-color:#121212;border:1px solid #444;border-radius:5px;padding:10px;color:var(--text-color);font-size:1em}
        .loader{border:4px solid var(--surface-color);border-top:4px solid var(--primary-color);border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:20px auto}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;max-width:450px;margin:0 auto;background-color:var(--surface-color);display:flex;justify-content:space-around;padding:10px 0;border-top:1px solid #333}
        .nav-item{display:flex;flex-direction:column;align-items:center;color:var(--text-secondary-color);cursor:pointer;border:none;background:none}.nav-item.active{color:var(--primary-color)}.nav-item .icon{font-size:1.6em}.nav-item .label{font-size:.7em}
    </style>
</head>
<body>
    <div class="app-container">
        <header class="app-header"><h1>DarePlay</h1></header>
        <main class="content">
            <section id="home" class="page active"><p>Dare feed will appear here.</p></section>
            <section id="create" class="page">
                <div id="create-content">
                    <div id="payment-container">
                        <h2>Unlock Your Dares</h2>
                        <p>Pay ‚Çπ10 to generate 5 unique and challenging dares.</p>
                        <button id="pay-btn" class="btn btn-primary" style="margin-top: 20px;" onclick="startPayment()">Pay ‚Çπ10 and Generate Dares</button>
                    </div>
                    <div id="loader" class="loader" style="display: none;"></div>
                    <form id="generated-dares-form" style="display: none;">
                        <button type="submit" class="btn btn-primary">üöÄ Publish All Proofs</button>
                    </form>
                </div>
            </section>
        </main>
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="showPage('home')">üè†<span class="label">Home</span></button>
        </nav>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        // ... Firebase ‡§ï‡§æ ‡§¨‡§æ‡§ï‡•Ä ‡§ï‡§æ ‡§ï‡•ã‡§° ‡§µ‡§π‡•Ä ‡§π‡•à ...
        
        // **‡§Ø‡§π‡§æ‡§Å ‡§¨‡§¶‡§≤‡§æ‡§µ ‡§ï‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ ‡§π‡•à**
        // ‡§Ö‡§¨ ‡§ï‡•ã‡§à ‡§π‡§æ‡§∞‡•ç‡§°-‡§ï‡•ã‡§°‡•á‡§° ‡§ï‡•Ä ‡§Ü‡§à‡§°‡•Ä ‡§®‡§π‡•Ä‡§Ç
        let razorpayKeyId;

        // ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã‡§§‡•á ‡§π‡•Ä ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§ï‡•Ä ‡§Ü‡§à‡§°‡•Ä ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const response = await fetch('/api/get-key');
                const data = await response.json();
                razorpayKeyId = data.keyId;
                document.getElementById('pay-btn').disabled = false; // ‡§ï‡•Ä ‡§Æ‡§ø‡§≤‡§®‡•á ‡§™‡§∞ ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§á‡§®‡•á‡§¨‡§≤ ‡§ï‡§∞‡•á‡§Ç
            } catch (error) {
                console.error("Could not fetch Razorpay Key ID:", error);
                alert("Cannot connect to payment service. Please refresh.");
            }
        });
        
        window.startPayment = async () => {
            if (!razorpayKeyId) {
                return alert("Payment key not loaded. Please wait or refresh the page.");
            }
            // ... ‡§¨‡§æ‡§ï‡•Ä ‡§ï‡§æ ‡§™‡•á‡§Æ‡•á‡§Ç‡§ü ‡§≤‡•â‡§ú‡§ø‡§ï ‡§µ‡§π‡•Ä ‡§π‡•à ...
            const loader = document.getElementById('loader');
            const payBtn = document.getElementById('pay-btn');
            loader.style.display = 'block';
            payBtn.disabled = true;

            try {
                const response = await fetch('/api/create-order', { method: 'POST' });
                const order = await response.json();
                
                const options = {
                    key: razorpayKeyId, // ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§Æ‡§ø‡§≤‡•Ä ‡§ï‡•Ä ‡§Ü‡§à‡§°‡•Ä ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç
                    amount: order.amount,
                    currency: order.currency,
                    name: "DarePlay",
                    description: "Dare Generation Charge",
                    order_id: order.id,
                    handler: async function (response) {
                        verifyPaymentAndGenerateDares(response);
                    },
                    prefill: { name: "Dare Player", email: "player@dareplay.com", contact: "9999999999" },
                    theme: { color: "#FF4848" }
                };
                const rzp1 = new Razorpay(options);
                rzp1.on('payment.failed', function (response) {
                    alert("Payment Failed: " + response.error.description);
                    loader.style.display = 'none';
                    payBtn.disabled = false;
                });
                rzp1.open();

            } catch (error) {
                alert("Could not initiate payment. Please try again.");
                loader.style.display = 'none';
                payBtn.disabled = false;
            }
        };

        // ‡§¨‡§æ‡§ï‡•Ä ‡§ï‡§æ ‡§ú‡§æ‡§µ‡§æ‡§∏‡•ç‡§ï‡•ç‡§∞‡§ø‡§™‡•ç‡§ü ‡§ï‡•ã‡§° (verifyPayment, displayDares, etc.) ‡§µ‡§π‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ
        async function verifyPaymentAndGenerateDares(paymentResponse) {
             const loader = document.getElementById('loader');
             const payBtn = document.getElementById('pay-btn');
             loader.style.display = 'block';
             document.getElementById('payment-container').style.display = 'none';

             try {
                 const response = await fetch('/api/verify-payment', {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: JSON.stringify(paymentResponse)
                 });
                 const result = await response.json();
                 if (result.error) throw new Error(result.error);
                
                 displayDares(result.dares);

             } catch (error) {
                 alert("An error occurred after payment: " + error.message);
                 loader.style.display = 'none';
             }
         }

         function displayDares(dares) {
            const loader = document.getElementById('loader');
             loader.style.display = 'none';
             const form = document.getElementById('generated-dares-form');
             let formHTML = '';
             const dareTypes = ["Looks Easy, But Is Hard", "Helpful", "Fear-Facing", "Fear-Facing", "Fear-Facing"];
             dares.forEach((dare, index) => {
                 formHTML += `
                     <div class="dare-block">
                         <p><strong>${dareTypes[index]}:</strong> ${dare}</p>
                         <input type="text" name="youtubeLink${index}" placeholder="Paste proof video link for this dare" required>
                     </div>
                 `;
             });
             form.insertAdjacentHTML('afterbegin', formHTML);
             form.style.display = 'block';
         }

         // ... ‡§´‡•â‡§∞‡•ç‡§Æ ‡§∏‡§¨‡§Æ‡§ø‡§∂‡§® ‡§ï‡§æ ‡§ï‡•ã‡§° ‡§≠‡•Ä ‡§µ‡§π‡•Ä ‡§∞‡§π‡•á‡§ó‡§æ ...

    </script>
</body>
</html>
