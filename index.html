<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome & Home</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&family=Exo+2:wght@800&display=swap" rel="stylesheet">

<script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
</script>
<!-- Razorpay Checkout SDK -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<style>
    /* Basic body styling */
    body {
        margin: 0;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden; /* Prevents horizontal scrollbars */
        background-color: #f0f2f5;
    }

    /* Splash screen container */
    #splash-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, #0077a2, #003f5c);
        display: flex;
        flex-direction: column; /* Centering content vertically */
        justify-content: center;
        align-items: center;
        transition: opacity 1.5s ease-out, visibility 1.5s;
        z-index: 100;
        overflow: hidden;
    }
    
    /* Animated background elements (more subtle) */
    #splash-screen::before, #splash-screen::after {
        content: '';
        position: absolute;
        width: 250px;
        height: 250px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 50%;
        animation: float 25s infinite linear;
        z-index: 1;
    }
    #splash-screen::before { top: -80px; left: -80px; }
    #splash-screen::after { bottom: -80px; right: -80px; animation-delay: -12.5s; }

    @keyframes float {
        0% { transform: translateY(0) translateX(0); }
        50% { transform: translateY(20px) translateX(-20px); }
        100% { transform: translateY(0) translateX(0); }
    }

    /* Caduceus Icon (w.jpg) */
    #caduceus-icon {
        width: clamp(80px, 20vw, 150px); /* Adjust size as needed */
        height: clamp(80px, 20vw, 150px); /* Make height equal to width for circle */
        border-radius: 50%; /* Make it circular */
        object-fit: cover; /* Ensure image covers the circle */
        margin-bottom: 20px; /* Space between icon and welcome text */
        z-index: 10;
        opacity: 0;
        animation: text-focus-in 1.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;
        animation-delay: 0.2s; /* Appear slightly before welcome text */
    }

    /* Welcome & Shubhmed Texts */
    .splash-text {
        font-family: 'Exo 2', sans-serif;
        font-weight: 800;
        color: white;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.9), 0 0 25px rgba(0, 255, 255, 0.7), 0 0 45px rgba(0, 0, 0, 0.5);
        letter-spacing: 3px;
        z-index: 10;
        opacity: 0;
        filter: blur(10px);
        animation: text-focus-in 1.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;
    }
    #welcome-text {
        font-size: clamp(3.5em, 14vw, 7em); /* Made bigger */
        animation-delay: 0.5s;
        margin-bottom: 10px; /* Pushed down slightly */
    }
    #shubhmed-text {
        font-size: clamp(1.2em, 5vw, 2.2em); /* Made smaller */
        margin-top: -20px; /* Adjusted position */
        animation-delay: 0.8s;
    }

    /* Tagline */
    #tagline {
        font-family: 'Poppins', sans-serif; /* Changed to Poppins for a different feel */
        font-weight: 700;
        color: white;
        text-shadow: 0 0 8px rgba(255, 255, 255, 0.8), 0 0 20px rgba(0, 255, 255, 0.6);
        letter-spacing: 1px;
        font-size: clamp(0.9em, 4vw, 1.5em); /* Adjust size as needed */
        text-align: center;
        margin-top: 15px; /* Space below model card */
        z-index: 10;
        opacity: 0;
        filter: blur(8px);
        animation: text-focus-in 1.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) forwards;
        animation-delay: 1.5s; /* Appear after model card */
        line-height: 1.4;
    }


    /* 1:1 Card for 3D Model */
    .model-card {
        width: 80%; /* Made smaller */
        max-width: 320px; /* Made smaller */
        aspect-ratio: 1 / 1;
        margin: 20px 0;
        border-radius: 25px;
        overflow: hidden;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3), inset 0 0 15px rgba(0, 230, 255, 0.5);
        border: 2px solid rgba(0, 230, 255, 0.7);
        z-index: 10;
        opacity: 0;
        transform: scale(0.8);
        animation: card-appear 1.5s cubic-bezier(0.550, 0.085, 0.680, 0.530) 1.2s forwards;
    }
    
    #model-canvas {
        width: 100% !important;
        height: 100% !important;
        display: block; /* remove default canvas margin */
    }
    
    @keyframes card-appear {
        100% { opacity: 1; transform: scale(1); }
    }

    @keyframes text-focus-in {
        0% { filter: blur(12px); opacity: 0; }
        100% { filter: blur(0px); opacity: 1; }
    }

    /* Buffer Loader */
    #buffer-loader {
        width: 60px; height: 60px; border: 5px solid rgba(0, 230, 255, 0.3);
        border-top-color: #00e5ff; border-radius: 50%;
        animation: spin 1.5s linear infinite; z-index: 15;
        display: none; margin-top: 20px;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* 3D Glowing Get Started button */
    #start-button {
        padding: 18px 40px; font-size: 1.3em; font-weight: bold;
        cursor: pointer; color: white; background: #008CBA;
        border: none; border-radius: 15px; margin-top: 20px;
        display: none; /* Hidden by default */
        box-shadow: 0 8px 0 #005f7a, 0 12px 20px rgba(0,0,0,0.4), 0 0 10px #00e5ff, inset 0 0 5px rgba(255,255,255,0.5);
        text-shadow: 0 0 5px #fff, 0 0 10px #00e5ff;
        transition: transform 0.2s ease-out, box-shadow 0.2s ease-out;
        z-index: 10; animation: glowing-button 2s infinite ease-in-out;
    }
    @keyframes glowing-button {
        0%, 100% { box-shadow: 0 8px 0 #005f7a, 0 12px 20px rgba(0,0,0,0.4), 0 0 10px #00e5ff, inset 0 0 5px rgba(255,255,255,0.5); }
        50% { box-shadow: 0 8px 0 #005f7a, 0 12px 20px rgba(0,0,0,0.4), 0 0 25px #00e5ff, inset 0 0 10px rgba(255,255,255,0.8); }
    }
    #start-button:hover { transform: translateY(-2px); }
    #start-button:active { transform: translateY(4px); box-shadow: 0 4px 0 #005f7a, 0 8px 15px rgba(0,0,0,0.35); }

    /* Dashboard Selection Screen */
    #dashboard-selection-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: #f0f2f5; display: none; flex-direction: column;
        justify-content: center; align-items: center; z-index: 90;
        padding: 20px; box-sizing: border-box;
    }
    .dashboard-btn {
        width: 100%; max-width: 400px; padding: 20px; margin: 15px 0;
        font-size: 1.2em; font-weight: bold; color: #fff;
        background: linear-gradient(145deg, #0097c9, #007095); border: none;
        border-radius: 12px; cursor: pointer;
        box-shadow: 0 6px 0 #004d66, 0 10px 18px rgba(0,0,0,0.3);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
    }
    .dashboard-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 0 #004d66, 0 12px 20px rgba(0,0,0,0.35); }
    .dashboard-btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #004d66, 0 6px 12px rgba(0,0,0,0.3); }

    /* General Page Styling */
    .page {
        display: none; flex-direction: column; width: 100%;
        min-height: 100vh; box-sizing: border-box;
    }
    #header { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        padding: 12px 15px; 
        background-color: #ffffff; 
        border-bottom: 1px solid #ddd; 
        box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
        position: sticky; 
        top: 0; 
        z-index: 50; 
    }
    .menu-icon { font-size: 28px; cursor: pointer; color: #333; padding: 5px; }
    .search-container { 
        display: flex; 
        align-items: center; 
        flex-grow: 1; 
        margin: 0 10px; /* Reduced margin for better fit */
        border: 1px solid #ccc; /* Added border to container */
        border-radius: 50px; /* Rounded overall search bar */
        overflow: hidden; /* To keep inner elements rounded */
    }
    .search-bar { 
        width: 100%; 
        padding: 10px 15px; 
        border: none; /* Removed individual border */
        outline: none; 
        font-size: 16px; 
        background-color: transparent; /* Ensure transparent background */
    }
    .search-button { 
        padding: 10px 15px; 
        border: none; /* Removed individual border */
        background-color: #f8f8f8; 
        cursor: pointer; 
        border-radius: 0; /* No specific rounding here, let container handle it */
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0; /* Prevent shrinking */
    }

    /* Coin Icon in Header */
    .coin-display {
        display: flex;
        align-items: center;
        margin-left: 10px; /* Space from search bar */
        font-weight: bold;
        color: #333;
        flex-shrink: 0; /* Prevent shrinking */
    }
    .coin-display svg {
        width: 24px;
        height: 24px;
        fill: gold; /* Gold color for coin */
        margin-right: 5px;
    }
    /* Specific styling for the profile page header elements */
    #profile-page #header .menu-icon,
    #profile-page #header .search-container,
    #profile-page #header .coin-display {
        display: none;
    }
    /* Adjust header for profile page to center "Welcome & Home" text */
    #profile-page #header {
        justify-content: center;
    }
    #profile-page #header > div:first-child { /* Targets the "Welcome & Home" div */
        margin: 0 auto; /* Centers the title */
    }
    /* Specific styling for the wallet page header elements */
    #wallet-page #header .menu-icon,
    #wallet-page #header .search-container {
        display: none;
    }

    .main-content { padding: 15px; overflow-y: auto; flex-grow: 1; padding-bottom: 85px; /* Space for bottom nav */ }
    .card-16-9 { width: 100%; padding-top: 56.25%; position: relative; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.15); cursor: pointer; margin-bottom: 20px;}
    .card-16-9 img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
    
    .action-button { display: block; width: 100%; margin-bottom: 20px; padding: 15px 20px; font-size: 1.2em; font-weight: bold; color: white; background: linear-gradient(145deg, #4CAF50, #2E7D32); border: none; border-radius: 12px; cursor: pointer; box-shadow: 0 6px 0 #1B5E20, 0 10px 18px rgba(0,0,0,0.3); transition: all 0.2s ease-in-out; }
    .action-button:hover { transform: translateY(-2px); box-shadow: 0 8px 0 #1B5E20, 0 12px 20px rgba(0,0,0,0.35); }

    .cards-1-1-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px; }
    .card-1-1 { width: 100%; aspect-ratio: 1 / 1; border-radius: 15px; overflow: hidden; box-shadow: 0 8px 25px rgba(0,0,0,0.15); cursor: pointer; position: relative; transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card-1-1:hover { transform: translateY(-5px); box-shadow: 0 12px 30px rgba(0,0,0,0.2); }
    .card-1-1 img { width: 100%; height: 100%; object-fit: cover; }

    .features-container-16-9 {
        position: relative; width: 100%; padding-top: 56.25%; border-radius: 15px;
        overflow: hidden; background: #fff; box-shadow: 0 8px 25px rgba(0,0,0,0.1); margin-top: 15px;
    }
    .features-section {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        padding: 15px; box-sizing: border-box; overflow-y: scroll; /* Changed to scroll */
    }
    .features-section h2 { text-align: center; font-size: 1.6em; color: #333; margin-top: 0; margin-bottom: 15px; }
    .features-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 15px; }
    .feature-item { 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        text-align: center; 
        cursor: pointer; 
        transition: transform 0.3s, box-shadow 0.3s;
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Subtle 3D effect */
    }
    .feature-item:hover { 
        transform: translateY(-5px); 
        box-shadow: 0 8px 16px rgba(0,0,0,0.2); 
    }
    .feature-item svg { 
        width: 40px; 
        height: 40px; 
        fill: #008CBA; 
        margin-bottom: 8px; 
        filter: drop-shadow(0 0 5px rgba(0,230,255,0.5)); /* 3D sticker effect */
    }
    .feature-item span { font-size: 0.8em; color: #555; font-weight: 600; }

    /* Care Page Specific Styles */
    .care-page-grid { display: flex; flex-direction: column; gap: 25px; }
    .care-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
    .care-card-wrapper { display: flex; flex-direction: column; align-items: center; }
    .care-card-wrapper img { width: 100%; aspect-ratio: 1 / 1; border-radius: 15px; object-fit: cover; box-shadow: 0 8px 25px rgba(0,0,0,0.15); background-color: #e0e0e0; }
    .care-card-wrapper-16-9 { width: 100%; }
    .care-card-wrapper-16-9 img { width: 100%; aspect-ratio: 16 / 9; border-radius: 15px; object-fit: cover; box-shadow: 0 8px 25px rgba(0,0,0,0.15); background-color: #e0e0e0; }
    .care-3d-btn {
        width: 90%; padding: 12px; margin-top: 15px; font-size: 1em; font-weight: bold; color: #fff;
        background: linear-gradient(145deg, #0097c9, #007095); border: none;
        border-radius: 12px; cursor: pointer;
        box-shadow: 0 5px 0 #004d66, 0 8px 15px rgba(0,0,0,0.25);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2); transition: all 0.2s ease-in-out;
        text-align: center;
        white-space: nowrap; /* Ensures text is on one line */
    }
    .care-3d-btn:hover { transform: translateY(-2px); box-shadow: 0 7px 0 #004d66, 0 10px 18px rgba(0,0,0,0.3); }
    .care-3d-btn:active { transform: translateY(2px); box-shadow: 0 3px 0 #004d66, 0 5px 12px rgba(0,0,0,0.3); }

    /* Tracker Page Specific Styles */
    .tracker-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); /* Adjusted for smaller screens */
        gap: 20px;
        margin-top: 20px;
    }
    .tracker-card-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #fff;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        padding-bottom: 15px; /* Space for the button */
    }
    .tracker-card-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0,0,0,0.2);
    }
    .tracker-card-item img {
        width: 100%;
        aspect-ratio: 1 / 1; /* 1:1 ratio for image part */
        object-fit: cover;
        border-radius: 15px 15px 0 0; /* Only top corners rounded for image */
        margin-bottom: 10px;
    }
    .tracker-btn {
        width: calc(100% - 20px); /* Account for padding */
        padding: 12px 15px;
        font-size: 0.95em;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(145deg, #0097c9, #007095);
        border: none;
        border-radius: 10px; /* Slightly smaller border-radius for button */
        cursor: pointer;
        box-shadow: 0 5px 0 #004d66, 0 8px 15px rgba(0,0,0,0.25);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
        text-align: center;
        white-space: normal; /* Allow text to wrap */
        word-wrap: break-word; /* Ensure long words break */
    }
    .tracker-btn:hover { transform: translateY(-2px); box-shadow: 0 7px 0 #004d66, 0 10px 18px rgba(0,0,0,0.3); }
    .tracker-btn:active { transform: translateY(2px); box-shadow: 0 3px 0 #004d66, 0 5px 12px rgba(0,0,0,0.3); }

    /* Disease Prediction & Info Pages Buttons */
    .prediction-info-buttons {
        display: flex;
        flex-direction: column;
        gap: 15px; /* Space between buttons */
        padding: 20px; /* Padding inside the container */
    }
    .prediction-info-btn {
        padding: 18px 25px;
        font-size: 1.1em;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(145deg, #4CAF50, #2E7D32); /* Green gradient */
        border: none;
        border-radius: 15px;
        cursor: pointer;
        box-shadow: 0 8px 0 #1B5E20, 0 12px 20px rgba(0,0,0,0.3);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
        text-align: center;
        white-space: nowrap; /* Prevent text wrapping for these buttons */
    }
    .prediction-info-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 0 #1B5E20, 0 15px 25px rgba(0,0,0,0.35); }
    .prediction-info-btn:active { transform: translateY(3px); box-shadow: 0 4px 0 #1B5E20, 0 8px 15px rgba(0,0,0,0.3); }
    .back-icon {
        font-size: 1.1em;
        font-weight: bold;
        color: #008CBA;
        cursor: pointer;
        padding: 10px;
    }

    /* Floating Medical Assistant */
    #medical-assistant-float {
        position: fixed;
        bottom: 90px; /* Above bottom nav */
        right: 20px;
        background: linear-gradient(145deg, #0097c9, #007095);
        color: white;
        border-radius: 50%;
        width: 70px;
        height: 70px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        cursor: grab; /* Indicates it's draggable */
        z-index: 40;
        transition: transform 0.1s ease; /* Smooth hover but quick drag */
        text-align: center;
    }
    #medical-assistant-float:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
    #medical-assistant-float:active {
        cursor: grabbing;
    }
    #medical-assistant-float svg {
        width: 35px;
        height: 35px;
        fill: white;
        margin-bottom: 3px;
        filter: drop-shadow(0 0 5px rgba(0,255,255,0.7)); /* 3D sticker effect for Medical Assistant */
    }
    #medical-assistant-float span {
        font-size: 0.7em;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    /* Side Menu */
    #side-menu {
        position: fixed;
        top: 0;
        left: -80vw; /* Hidden by default */
        width: 80vw;
        max-width: 300px;
        height: 100%;
        background-color: #fff;
        box-shadow: 5px 0 15px rgba(0,0,0,0.2);
        z-index: 1000; /* High z-index to be on top */
        transition: left 0.3s ease-in-out;
        display: flex;
        flex-direction: column;
        padding-top: 20px;
    }
    #side-menu.open {
        left: 0;
    }
    .menu-header {
        font-size: 1.8em;
        font-weight: bold;
        color: #333;
        padding: 15px 20px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .close-menu {
        font-size: 2em;
        cursor: pointer;
        color: #999;
    }
    .menu-options {
        display: flex;
        flex-direction: column;
        padding: 20px;
        gap: 15px;
    }
    .menu-btn {
        width: 100%;
        padding: 15px 20px;
        font-size: 1.1em;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(145deg, #0097c9, #007095);
        border: none;
        border-radius: 12px;
        cursor: pointer;
        box-shadow: 0 6px 0 #004d66, 0 10px 18px rgba(0,0,0,0.3);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
        text-align: center;
    }
    .menu-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 0 #004d66, 0 12px 20px rgba(0,0,0,0.35); }
    .menu-btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #004d66, 0 6px 12px rgba(0,0,0,0.3); }

    /* Profile Page specific styles */
    #profile-page {
        align-items: center;
        padding-top: 30px; /* Adjust as needed */
    }
    #profile-image-container {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background-color: #ddd;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        margin-bottom: 30px;
        box-shadow: 0 8px 15px rgba(0,0,0,0.2), inset 0 0 10px rgba(0, 230, 255, 0.5);
        border: 2px solid rgba(0, 230, 255, 0.7);
        position: relative;
        cursor: pointer;
    }
    #profile-image-container img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    #profile-image-container input[type="file"] {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
    }
    #profile-image-placeholder {
        font-size: 0.9em;
        color: #555;
        text-align: center;
        padding: 10px;
    }

    .profile-buttons {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 90%;
        max-width: 400px;
    }
    .profile-btn {
        padding: 18px 25px;
        font-size: 1.1em;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(145deg, #0097c9, #007095);
        border: none;
        border-radius: 15px;
        cursor: pointer;
        box-shadow: 0 8px 0 #004d66, 0 12px 20px rgba(0,0,0,0.3);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
        text-align: center;
    }
    .profile-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 0 #004d66, 0 15px 25px rgba(0,0,0,0.35); }
    .profile-btn:active { transform: translateY(3px); box-shadow: 0 4px 0 #004d66, 0 8px 15px rgba(0,0,0,0.3); }

    /* Edit Profile Form */
    #edit-profile-page {
        display: none;
        flex-direction: column;
        width: 100%;
        min-height: 100vh;
        box-sizing: border-box;
        align-items: center;
        padding: 20px;
    }
    .profile-form-group {
        width: 100%;
        max-width: 400px;
        margin-bottom: 15px;
    }
    .profile-form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
    }
    .profile-form-group input {
        width: calc(100% - 20px);
        padding: 12px 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 1em;
        box-sizing: border-box;
    }
    .profile-form-group input:focus {
        border-color: #008CBA;
        outline: none;
        box-shadow: 0 0 5px rgba(0, 140, 186, 0.3);
    }
    .save-profile-btn {
        width: 90%;
        max-width: 400px;
        padding: 18px 25px;
        font-size: 1.1em;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(145deg, #4CAF50, #2E7D32);
        border: none;
        border-radius: 15px;
        cursor: pointer;
        box-shadow: 0 8px 0 #1B5E20, 0 12px 20px rgba(0,0,0,0.3);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
        text-align: center;
        margin-top: 20px;
    }
    .save-profile-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 0 #1B5E20, 0 15px 25px rgba(0,0,0,0.35); }
    .save-profile-btn:active { transform: translateY(3px); box-shadow: 0 4px 0 #1B5E20, 0 8px 15px rgba(0,0,0,0.3); }


    /* Wallet Page Styles */
    #wallet-page {
        align-items: center;
        padding-top: 20px;
    }
    .wallet-card {
        width: 90%;
        max-width: 300px;
        aspect-ratio: 1 / 1;
        background: linear-gradient(145deg, #ffdd00, #ffc400); /* Gold gradient */
        border-radius: 20px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2), inset 0 0 15px rgba(255,255,255,0.7);
        border: 2px solid rgba(255,215,0,0.8);
        margin-bottom: 30px;
        position: relative;
        overflow: hidden;
    }
    .wallet-card::before {
        content: '';
        position: absolute;
        width: 120%;
        height: 120%;
        background: radial-gradient(circle at top left, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 70%);
        border-radius: 50%;
        top: -10%;
        left: -10%;
        transform: rotate(45deg);
    }
    .wallet-card svg {
        width: 80px;
        height: 80px;
        fill: #444; /* Darker color for icon on gold */
        margin-bottom: 15px;
        filter: drop-shadow(2px 2px 5px rgba(0,0,0,0.3));
    }
    .wallet-card .coin-value {
        font-family: 'Exo 2', sans-serif;
        font-weight: 800;
        font-size: 4em;
        color: #333;
        text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
    }
    .buy-coin-button {
        width: 90%;
        max-width: 400px;
        padding: 18px 25px;
        font-size: 1.1em;
        font-weight: bold;
        color: #fff;
        background: linear-gradient(145deg, #28a745, #1d7b30); /* Green for buying */
        border: none;
        border-radius: 15px;
        cursor: pointer;
        box-shadow: 0 8px 0 #125e22, 0 12px 20px rgba(0,0,0,0.3);
        text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        transition: all 0.2s ease-in-out;
        text-align: center;
        margin-top: 20px;
    }
    .buy-coin-button:hover { transform: translateY(-2px); box-shadow: 0 10px 0 #125e22, 0 15px 25px rgba(0,0,0,0.35); }
    .buy-coin-button:active { transform: translateY(3px); box-shadow: 0 4px 0 #125e22, 0 8px 15px rgba(0,0,0,0.3); }


    /* Bottom Navigation Bar */
    .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background-color: #fff; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 50; }
    .nav-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: #999; transition: color 0.3s; }
    .nav-item svg { width: 28px; height: 28px; fill: currentColor; margin-bottom: 4px; }
    .nav-item span { font-size: 12px; }
    .nav-item.active, .nav-item:hover { color: #008CBA; }

</style>

</head>
<body>

<div id="splash-screen">
    <img src="image/w.jpg" alt="Welcome Icon" id="caduceus-icon">
    <div id="welcome-text" class="splash-text">Welcome</div>
    <div id="shubhmed-text" class="splash-text">Shubhmed</div>
    <div class="model-card">
        <canvas id="model-canvas"></canvas>
    </div>
    <div id="tagline" class="splash-text">See Your Health<br>Shape Your Future</div>
    <div id="buffer-loader"></div>
    <button id="start-button">Get Started</button>
</div>

<div id="dashboard-selection-screen">
    <button class="dashboard-btn" id="patient-dashboard-btn">Patient Dashboard</button>
    <button class="dashboard-btn" onclick="showFuturePlan()">Doctor Dashboard</button>
    <button class="dashboard-btn" onclick="showFuturePlan()">Pharmacy Dashboard</button>
    <button class="dashboard-btn" onclick="showFuturePlan()">Lab Dashboard</button>
</div>

<!-- HOME PAGE -->
<div id="home-page" class="page">
    <header id="header">
        <div class="menu-icon" onclick="showSideMenu()">&#9776;</div>
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search for anything...">
            <button class="search-button" onclick="showFuturePlan()">&#128269;</button>
        </div>
        <div class="coin-display">
            <!-- Updated Coin SVG for a solid yellow circle with white inner circle -->
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="header-coin-balance">100</span>
        </div>
    </header>

<div class="main-content">
    <div class="card-16-9" onclick="showFuturePlan()">
        <img src="https://i.ibb.co/4gwqRdRN/Fsz7-K1w-Qn6-TMo-AZNqj-Ehg.webp" alt="Health Banner">
    </div>
    <button class="action-button" onclick="showFuturePlan()">Medicine Waste Change</button>
    <div class="cards-1-1-container">
        <div class="card-1-1" onclick="showFuturePlan()"><img src="https://i.ibb.co/DPC0kqZn/s-EQOZCNKT2-Cvj-NMiih4nvg.webp" alt="Pharmacy"></div>
        <div class="card-1-1" onclick="showFuturePlan()"><img src="https://i.ibb.co/LDqDXny5/5-MSTd-FGm-S1m-GCrb-Yg-z-Bg-A.webp" alt="Service 2"></div>
        <div class="card-1-1" onclick="showFuturePlan()"><img src="https://i.ibb.co/DHSVkn7T/Go9-8-Wo-STXCv-AO-SIQOoiw.webp" alt="Service 3"></div>
    </div>
    <h2 style="text-align: center; font-size: 1.6em; color: #333; margin-bottom: 15px;">Features</h2>
    <div class="features-container-16-9">
        <div class="features-section">
            <div class="features-grid">
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43L20.57 12L17 15.57L8.43 7L12 3.43L10.57 2L9.14 3.43L7.71 2L5.57 4.14L4.14 2.71L2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57l3.43-3.43L17 20.57l1.43-1.43L20.57 22l2.14-2.14l-1.43-1.43l1.43-1.43l-1.43-1.43z M12 10.57L13.43 12L10.57 14.86L9.14 13.43z"></path></svg><span>Exercise Planner</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg><span>Health Habit Builder</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M16.5 4.5c1.9 0 3.5 1.6 3.5 3.5s-1.6 3.5-3.5 3.5-3.5-1.6-3.5-3.5 1.6-3.5 3.5-3.5m-3.9 6.5h-1.2c-1.1 0-2.2.4-2.9 1.2s-1.2 1.8-1.2 2.9v1.2c0 .6-.4 1-1 1s-1-.4-1-1v-1.2c0-1.7.7-3.4 1.9-4.6s2.9-1.9 4.6-1.9h1.2c.6 0 1 .4 1 1s-.4 1-1 1zm-1.6-6c-1.4 0-2.5 1.1-2.5 2.5s1.1 2.5 2.5 2.5 2.5-1.1 2.5-2.5-1.1-2.5-2.5-2.5zm4.5 6.5c-.3 0-.5.1-.7.3-.2.2-.3.4-.3.7s.1.5.3.7c.2.2.4.3.7.3s.5-.1.7-.3c.2-.2.3-.4.3-.7s-.1-.5-.3-.7c-.2-.2-.4-.3-.7-.3zM9 19H4v-5h5v5zm-1-4v3h-3v-3h3zm12-2h-5v5h5v-5zm-1 4v-3h-3v3h3z"></path></svg><span>AI Diet Planner</span></div>
                
                <!-- New Features -->
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 16c-3.31 0-6-2.69-6-6s2.69-6 6-6 6 2.69 6 6-2.69 6-6 6m0-10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"></path></svg><span>Advance Care</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M11.5,17L12.5,14H11V8L12.5,11H14L12.5,14H14V17H11.5M12.5,10.5C13.06,10.5 13.5,10.06 13.5,9.5S13.06,8.5 12.5,8.5S11.5,8.94 11.5,9.5S11.94,10.5 12.5,10.5Z"></path></svg><span>Spine Health</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-1-12h2v6h-2z"></path></svg><span>Mental Health</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-3.5 10c.83 0 1.5-.67 1.5-1.5S17.33 9 16.5 9s-1.5.67-1.5 1.5.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.83 9 9 9s-1.5.67-1.5 1.5.67 1.5 1.5 1.5z"></path></svg><span>CBT</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-8 2h6l-3.5 4.5-2.5-2.5-4 5V6z"></path></svg><span>Virtual Therapy</span></div>
                <div class="feature-item" onclick="showFuturePlan()"><svg viewBox="0 0 24 24"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m-1-13h2v4h-2zm0 6h2v2h-2z"></path></svg><span>Pre Habilitation</span></div>
            </div>
        </div>
    </div>
</div>
</div>

<!-- Floating Medical Assistant -->
<div id="medical-assistant-float">
    <svg viewBox="0 0 24 24"><path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,7A3,3 0 0,0 9,10A3,3 0 0,0 12,13A3,3 0 0,0 15,10A3,3 0 0,0 12,7M7.5,16.5C7.5,14.67 9.83,13 12,13C14.17,13 16.5,14.67 16.5,16.5V17H7.5V16.5Z"></path></svg>
    <span>Medical Assistant</span>
</div>

<!-- CARE PAGE -->
<div id="care-page" class="page">
    <header id="header">
        <div class="menu-icon" onclick="showSideMenu()">&#9776;</div>
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search care services...">
            <button class="search-button" onclick="showFuturePlan()">&#128269;</button>
        </div>
        <div class="coin-display">
            <!-- Updated Coin SVG for a solid yellow circle with white inner circle -->
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="care-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content">
        <div class="care-page-grid">
            <!-- Row 1 -->
            <div class="care-row">
                <div class="care-card-wrapper" onclick="showFuturePlan()">
                    <img src="image/skincare.jpg" alt="Skin Care">
                    <button class="care-3d-btn">Skin Care</button>
                </div>
                <div class="care-card-wrapper" onclick="showFuturePlan()">
                    <img src="image/dental care .jpg" alt="Dental Care">
                    <button class="care-3d-btn">Dental Care</button>
                </div>
                <div class="care-card-wrapper" onclick="showFuturePlan()">
                    <img src="image/eye care .jpg" alt="Eye Care">
                    <button class="care-3d-btn">Eye Care</button>
                </div>
            </div>

<!-- Row 2 -->
        <div class="care-card-wrapper-16-9" onclick="showFuturePlan()">
            <img src="image/women's health .jpg" alt="Women Health Care">
            <button class="care-3d-btn">Women Health Care</button>
        </div>

        <!-- Row 3 -->
        <div class="care-row">
            <div class="care-card-wrapper" onclick="showFuturePlan()">
                <img src="image/ear.jpg" alt="Ear Care">
                <button class="care-3d-btn">Ear Care</button>
            </div>
            <div class="care-card-wrapper" onclick="showFuturePlan()">
                <img src="image/sexual health.jpg" alt="Sexual Health Care">
                <button class="care-3d-btn">Sexual Health</button>
            </div>
            <div class="care-card-wrapper" onclick="showFuturePlan()">
                <img src="image/elder care .jpg" alt="Elder Care">
                <button class="care-3d-btn">Elder Care</button>
            </div>
        </div>
    </div>
</div>
</div>

<!-- TRACKER PAGE -->
<div id="tracker-page" class="page">
    <header id="header">
        <div class="menu-icon" onclick="showSideMenu()">&#9776;</div>
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search for trackers...">
            <button class="search-button" onclick="showFuturePlan()">&#128269;</button>
        </div>
        <div class="coin-display">
            <!-- Updated Coin SVG for a solid yellow circle with white inner circle -->
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="tracker-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content">
        <div class="tracker-grid">
            <!-- Card 1 -->
            <div class="tracker-card-item">
                <img src="image/water intake tracker .jpg" alt="Water Intake Tracker">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Water Intake Tracker">Water Intake Tracker</button>
            </div>
            <!-- Card 2 -->
            <div class="tracker-card-item">
                <img src="image/child.jpg" alt="Child Growth Tracker">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Child Growth Tracker">Child Growth Tracker</button>
            </div>
            <!-- Card 3 -->
            <div class="tracker-card-item">
                <img src="image/copd.jpg" alt="COPD Tracker">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="COPD Tracker">COPD Tracker</button>
            </div>
            <!-- Card 4 -->
            <div class="tracker-card-item">
                <img src="image/sleep.jpg" alt="Sleep Tracker">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Sleep Tracker">Sleep Tracker</button>
            </div>
            <!-- Card 5 -->
            <div class="tracker-card-item">
                <img src="image/prenatal fitness .jpg" alt="Prenatal Fitness">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Prenatal Fitness">Prenatal Fitness</button>
            </div>
            <!-- Card 6 -->
            <div class="tracker-card-item">
                <img src="image/brain.jpg" alt="Brain Training">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Brain Training">Brain Training</button>
            </div>
            <!-- Card 7 -->
            <div class="tracker-card-item">
                <img src="image/gut analysers.jpg" alt="Gut Analyser">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Gut Analyser">Gut Analyser</button>
            </div>
            <!-- Card 8 -->
            <div class="tracker-card-item">
                <img src="image/meditation.jpg" alt="Meditation">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Meditation">Meditation</button>
            </div>
            <!-- Card 9 -->
            <div class="tracker-card-item">
                <img src="image/elder health tracker.jpg" alt="Elder Health Tracker">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Elder Health Tracker">Elder Health Tracker</button>
            </div>
            <!-- Card 10 -->
            <div class="tracker-card-item">
                <img src="image/family health hub.jpg" alt="Family Health Hub">
                <button class="tracker-btn" data-target-page="showFuturePlan" data-feature-cost="1" data-feature-name="Family Health Hub">Family Health Hub</button>
            </div>
            <!-- Card 11 -->
            <div class="tracker-card-item">
                <img src="image/disease prediction.jpg" alt="Disease Prediction">
                <button class="tracker-btn" data-target-page="disease-prediction">Disease Prediction</button>
            </div>
            <!-- Card 12 -->
            <div class="tracker-card-item">
                <img src="image/disease info.jpg" alt="Disease Info">
                <button class="tracker-btn" data-target-page="disease-info">Disease Info</button>
            </div>
        </div>
    </div>
</div>

<!-- DISEASE PREDICTION PAGE -->
<div id="disease-prediction-page" class="page">
    <header id="header">
        <div class="back-icon" onclick="goBackToTracker()">&#8592; Back</div>
        <div style="flex-grow: 1; text-align: center; font-weight: bold; font-size: 1.2em; color: #333;">Disease Prediction</div>
        <div class="coin-display">
            <!-- Updated Coin SVG for a solid yellow circle with white inner circle -->
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="prediction-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content prediction-info-buttons">
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Heart Attack Prediction</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Stroke Risk Prediction</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Chronic Disease Prediction</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Cancer Screening</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Diabetes Prediction</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Allergy Prediction</button>
    </div>
</div>

<!-- DISEASE INFO PAGE -->
<div id="disease-info-page" class="page">
    <header id="header">
        <div class="back-icon" onclick="goBackToTracker()">&#8592; Back</div>
        <div style="flex-grow: 1; text-align: center; font-weight: bold; font-size: 1.2em; color: #333;">Disease Information</div>
        <div class="coin-display">
            <!-- Updated Coin SVG for a solid yellow circle with white inner circle -->
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="info-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content prediction-info-buttons">
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">CPR Learning</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Rare Disease Learning</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Emergency Medical Info</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">First Aid Guide</button>
        <button class="prediction-info-btn" onclick="consumeCoinAndShowFuturePlan()">Longevity Health Span</button>
    </div>
</div>

<!-- CONSULTANT PAGE -->
<div id="consultant-page" class="page">
    <header id="header">
        <div class="menu-icon" onclick="showSideMenu()">&#9776;</div>
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search for doctors...">
            <button class="search-button" onclick="showFuturePlan()">&#128269;</button>
        </div>
        <div class="coin-display">
            <!-- Updated Coin SVG for a solid yellow circle with white inner circle -->
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="consultant-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content">
        <h2 style="text-align: center; font-size: 1.6em; color: #333; margin-top: 15px;">Our Consultants</h2>
        <p style="text-align: center; color: #666;">Doctor list will appear here in a future update.</p>
        <!-- Placeholder for doctor list -->
    </div>
</div>

<!-- PROFILE PAGE -->
<div id="profile-page" class="page">
    <header id="header">
        <!-- These elements are now hidden by CSS for the profile page header -->
        <div class="menu-icon" onclick="showSideMenu()">&#9776;</div>
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search profile options...">
            <button class="search-button" onclick="showFuturePlan()">&#128269;</button>
        </div>
        <div class="coin-display">
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="profile-coin-balance">100</span>
        </div>
        <!-- Title for the profile page header -->
        <div style="font-weight: bold; font-size: 1.2em; color: #333;">Welcome & Home</div>
    </header>
    <div class="main-content" style="display: flex; flex-direction: column; align-items: center;">
        <div id="profile-image-container">
            <img id="profile-picture" src="" alt="Profile Picture" style="display: none;">
            <span id="profile-image-placeholder">Tap to add image</span>
            <input type="file" id="profile-image-upload" accept="image/*">
        </div>

        <div class="profile-buttons">
            <button class="profile-btn" onclick="showEditProfile()">Edit Profile</button>
            <button class="profile-btn" onclick="showWalletPage()">Wallet</button>
            <button class="profile-btn" onclick="logOut()">Log Out</button>
        </div>
    </div>
</div>

<!-- EDIT PROFILE PAGE -->
<div id="edit-profile-page" class="page">
    <header id="header">
        <div class="back-icon" onclick="goBackToProfile()">&#8592; Back</div>
        <div style="flex-grow: 1; text-align: center; font-weight: bold; font-size: 1.2em; color: #333;">Edit Profile</div>
        <div class="coin-display">
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="edit-profile-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content" style="display: flex; flex-direction: column; align-items: center; padding-top: 20px;">
        <div class="profile-form-group">
            <label for="profile-name">Name:</label>
            <input type="text" id="profile-name" placeholder="Enter your name">
        </div>
        <div class="profile-form-group">
            <label for="profile-mobile">Mobile No.:</label>
            <input type="tel" id="profile-mobile" placeholder="Enter your mobile number">
        </div>
        <div class="profile-form-group">
            <label for="profile-address">Address:</label>
            <input type="text" id="profile-address" placeholder="Enter your address">
        </div>
        <div class="profile-form-group">
            <label for="profile-email">Email ID:</label>
            <input type="email" id="profile-email" placeholder="Enter your email ID" readonly> <!-- Email usually read-only if from auth -->
        </div>
        <button class="save-profile-btn" onclick="saveUserProfile()">Save Profile</button>
    </div>
</div>

<!-- WALLET PAGE -->
<div id="wallet-page" class="page">
    <header id="header" style="background-color: transparent; box-shadow: none; border-bottom: none;">
        <div class="back-icon" onclick="goBackToProfile()">&#8592; Back</div>
        <div style="flex-grow: 1; text-align: center; font-weight: bold; font-size: 1.2em; color: #333;">Wallet</div>
        <div class="coin-display">
            <svg viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10" fill="currentColor"/>
                <circle cx="12" cy="12" r="4" fill="white"/>
            </svg>
            <span id="wallet-coin-balance">100</span>
        </div>
    </header>
    <div class="main-content" style="display: flex; flex-direction: column; align-items: center; justify-content: center; flex-grow: 1;">
        <div class="wallet-card">
            <svg viewBox="0 0 24 24">
                <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M12,7C10.61,7 9.5,8.12 9.5,9.5C9.5,10.88 10.61,12 12,12C13.39,12 14.5,10.88 14.5,9.5C14.5,8.12 13.39,7 12,7M7.5,16.5C7.5,14.67 9.83,13 12,13C14.17,13 16.5,14.67 16.5,16.5V17H7.5V16.5Z"></path>
            </svg>
            <span class="coin-value" id="wallet-card-coin-value">100</span>
        </div>
        <button class="buy-coin-button" onclick="buyCoins(5, 100)">Buy 5 Coins for â‚¹1</button>
        <!-- Add more "buy" options if needed -->
    </div>
</div>


<!-- SIDE MENU -->
<div id="side-menu">
    <div class="menu-header">Menu <span class="close-menu" onclick="hideSideMenu()">&times;</span></div>
    <div class="menu-options">
        <button class="menu-btn" onclick="showFuturePlan()">Appointment Management</button>
        <button class="menu-btn" onclick="showFuturePlan()">Holistic Chronic Pain Management</button>
        <button class="menu-btn" onclick="showFuturePlan()">Health Insurance</button>
        <button class="menu-btn" onclick="showFuturePlan()">Medical Bill</button>
    </div>
</div>

<nav class="bottom-nav">
    <div class="nav-item active" id="nav-home"><svg viewBox="0 0 24 24"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"></path></svg><span>Home</span></div>
    <div class="nav-item" id="nav-consultant"><svg viewBox="0 0 24 24"><path d="M20,6H16V2H8V6H4C2.9,6 2,6.9 2,8V19C2,20.1 2.9,21 4,21H20C21.1,21 22,20.1 22,19V8C22,6.9 21.1,6 20,6M10,4H14V6H10V4M20,19H4V8H20V19M12,10.5L14,12.5L12,14.5L10,12.5L12,10.5Z"></path></svg><span>Consultant</span></div>
    <div class="nav-item" id="nav-care"><svg viewBox="0 0 24 24"><path d="M12,2C6.48,2 2,6.48 2,12C2,17.52 6.48,22 12,22C17.52,22 22,17.52 22,12C22,6.48 17.52,2 12,2M12,20C7.59,20 4,16.41 4,12C4,11.56 4.05,11.12 4.14,10.7C5.9,10.14 7.5,9 7.5,7C7.5,6.05 7.08,5.19 6.4,4.58C7.5,3.14 9.12,2.29 11,2.06C11.33,3.15 12.28,4 13.5,4C14.72,4 15.67,3.15 16,2.06C17.88,2.29 19.5,3.14 20.6,4.58C19.92,5.19 19.5,6.05 19.5,7C19.5,9 21.1,10.14 22.86,10.7C22.95,11.12 23,11.56 23,12C22.97,16.41 19.41,20 15,20H9Z"></path></svg><span>Care</span></div>
    <div class="nav-item" id="nav-tracker"><svg viewBox="0 0 24 24"><path d="M3,3H21V5H3V3M3,7H15V9H3V7M3,11H21V13H3V11M3,15H15V17H3V15M3,19H21V21H3V19Z"></path></svg><span>Tracker</span></div>
    <div class="nav-item" id="nav-profile"><svg viewBox="0 0 24 24"><path d="M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z"></path></svg><span>Profile</span></div>
</nav>

<script type="module">
    import * as THREE from 'three';
    import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // Import Firebase modules
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB2PG5JvDko2UmQDlY9gN5lBgga2vQy-Ws",
      authDomain: "conceptra-c1000.firebaseapp.com",
      databaseURL: "https://conceptra-c1000-default-rtdb.firebaseio.com",
      projectId: "conceptra-c1000",
      storageBucket: "conceptra-c1000.firebasestorage.app",
      messagingSenderId: "298402987968",
      appId: "1:298402987968:web:c0d0d7d6c08cdfa6bc5225",
      measurementId: "G-QRQYEVSJJ6"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const db = getDatabase(app);

    let currentUserId = null;
    let currentCoinBalance = 0;

    // --- Element References ---
    const splashScreen = document.getElementById('splash-screen');
    const dashboardSelectionScreen = document.getElementById('dashboard-selection-screen');
    const homePage = document.getElementById('home-page');
    const carePage = document.getElementById('care-page');
    const trackerPage = document.getElementById('tracker-page'); 
    const diseasePredictionPage = document.getElementById('disease-prediction-page'); 
    const diseaseInfoPage = document.getElementById('disease-info-page'); 
    const consultantPage = document.getElementById('consultant-page'); 
    const profilePage = document.getElementById('profile-page'); 
    const editProfilePage = document.getElementById('edit-profile-page'); // New Edit Profile Page
    const walletPage = document.getElementById('wallet-page'); // New Wallet Page
    const sideMenu = document.getElementById('side-menu'); 
    const loader = document.getElementById('buffer-loader');
    const startButton = document.getElementById('start-button');
    const patientDashboardButton = document.getElementById('patient-dashboard-btn');
    const navItems = document.querySelectorAll('.nav-item');
    const navHome = document.getElementById('nav-home');
    const navConsultant = document.getElementById('nav-consultant'); 
    const navCare = document.getElementById('nav-care');
    const navTracker = document.getElementById('nav-tracker'); 
    const navProfile = document.getElementById('nav-profile'); 
    const medicalAssistantFloat = document.getElementById('medical-assistant-float');

    const profilePictureInput = document.getElementById('profile-image-upload');
    const profilePictureImg = document.getElementById('profile-picture');
    const profilePicturePlaceholder = document.getElementById('profile-image-placeholder');

    // Profile Edit Form Elements
    const profileNameInput = document.getElementById('profile-name');
    const profileMobileInput = document.getElementById('profile-mobile');
    const profileAddressInput = document.getElementById('profile-address');
    const profileEmailInput = document.getElementById('profile-email');

    // Coin Balance Display Elements
    const headerCoinBalance = document.getElementById('header-coin-balance');
    const careCoinBalance = document.getElementById('care-coin-balance');
    const trackerCoinBalance = document.getElementById('tracker-coin-balance');
    const predictionCoinBalance = document.getElementById('prediction-coin-balance');
    const infoCoinBalance = document.getElementById('info-coin-balance');
    const consultantCoinBalance = document.getElementById('consultant-coin-balance');
    const profileCoinBalance = document.getElementById('profile-coin-balance');
    const editProfileCoinBalance = document.getElementById('edit-profile-coin-balance');
    const walletCoinBalance = document.getElementById('wallet-coin-balance');
    const walletCardCoinValue = document.getElementById('wallet-card-coin-value');


    // --- Firebase Authentication and Data Loading ---
    onAuthStateChanged(auth, (user) => {
        if (user) {
            currentUserId = user.uid;
            console.log("User signed in:", currentUserId);
            // Load user data and coins after successful authentication
            loadUserData();
            loadCoinBalance();
        } else {
            console.log("No user signed in. Signing in anonymously...");
            // Sign in anonymously if no user is found
            signInAnonymously(auth)
                .then(() => {
                    // User will be available in the next onAuthStateChanged call
                })
                .catch((error) => {
                    console.error("Anonymous sign-in failed:", error);
                    alert("Failed to connect to our services. Please try again.");
                });
        }
    });

    function loadUserData() {
        if (!currentUserId) return;
        const userProfileRef = ref(db, 'users/' + currentUserId + '/profile');
        onValue(userProfileRef, (snapshot) => {
            const data = snapshot.val();
            if (data) {
                profileNameInput.value = data.name || '';
                profileMobileInput.value = data.mobile || '';
                profileAddressInput.value = data.address || '';
                profileEmailInput.value = data.email || auth.currentUser.email || ''; // Use Firebase Auth email if available
            } else {
                // Initialize profile with current user email if available
                profileEmailInput.value = auth.currentUser.email || '';
            }
        }, {
            onlyOnce: false // Listen for real-time updates
        });
    }

    function loadCoinBalance() {
        if (!currentUserId) return;
        const userCoinsRef = ref(db, 'users/' + currentUserId + '/coins');
        onValue(userCoinsRef, (snapshot) => {
            const coins = snapshot.val();
            if (coins === null || isNaN(coins)) {
                // Initialize coins if they don't exist or are invalid
                currentCoinBalance = 100; // Default starting coins
                set(userCoinsRef, currentCoinBalance)
                    .then(() => {
                        console.log("Coin balance initialized to 100.");
                        updateCoinDisplays();
                    })
                    .catch((error) => {
                        console.error("Failed to set initial coin balance:", error);
                    });
            } else {
                currentCoinBalance = coins;
                updateCoinDisplays();
            }
        }, {
            onlyOnce: false // Listen for real-time updates
        });
    }

    function updateCoinDisplays() {
        if (headerCoinBalance) headerCoinBalance.textContent = currentCoinBalance;
        if (careCoinBalance) careCoinBalance.textContent = currentCoinBalance;
        if (trackerCoinBalance) trackerCoinBalance.textContent = currentCoinBalance;
        if (predictionCoinBalance) predictionCoinBalance.textContent = currentCoinBalance;
        if (infoCoinBalance) infoCoinBalance.textContent = currentCoinBalance;
        if (consultantCoinBalance) consultantCoinBalance.textContent = currentCoinBalance;
        if (profileCoinBalance) profileCoinBalance.textContent = currentCoinBalance;
        if (editProfileCoinBalance) editProfileCoinBalance.textContent = currentCoinBalance;
        if (walletCoinBalance) walletCoinBalance.textContent = currentCoinBalance;
        if (walletCardCoinValue) walletCardCoinValue.textContent = currentCoinBalance;
    }

    /**
     * Attempts to consume a coin.
     * @returns {boolean} True if a coin was successfully consumed, false otherwise.
     */
    window.consumeCoin = async function(cost = 1) {
        if (!currentUserId) {
            alert("User not logged in. Cannot consume coin.");
            return false;
        }

        if (currentCoinBalance >= cost) {
            try {
                const userCoinsRef = ref(db, 'users/' + currentUserId + '/coins');
                await update(userCoinsRef, { value: currentCoinBalance - cost });
                console.log(`Consumed ${cost} coin(s). Remaining: ${currentCoinBalance - cost}`);
                // currentCoinBalance is updated by onValue listener
                return true;
            } catch (error) {
                console.error("Failed to consume coin:", error);
                alert("Failed to consume coin. Please try again.");
                return false;
            }
        } else {
            alert("Not enough coins! Please buy more coins to use this feature.");
            return false;
        }
    };

    window.consumeCoinAndShowFuturePlan = async function() {
        const consumed = await consumeCoin(1); // Assuming 1 coin per AI function use
        if (consumed) {
            showFuturePlan();
        }
    };

    // --- Page Navigation Logic ---
    function switchPage(pageToShow) {
        document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
        if (pageToShow) {
            pageToShow.style.display = 'flex';
            // Hide side menu if open when switching pages
            if (sideMenu && sideMenu.classList.contains('open')) {
                hideSideMenu();
            }
            updateCoinDisplays(); // Update coin display on page switch
        }
    }

    function updateActiveNav(activeItem) {
        navItems.forEach(item => item.classList.remove('active'));
        if (activeItem) {
            activeItem.classList.add('active');
        }
    }
    
    navHome.onclick = () => {
        switchPage(homePage);
        updateActiveNav(navHome);
    };

    navConsultant.onclick = () => {
        switchPage(consultantPage);
        updateActiveNav(navConsultant);
    };

    navCare.onclick = () => {
        switchPage(carePage);
        updateActiveNav(navCare);
    };

    navTracker.onclick = () => {
        switchPage(trackerPage);
        updateActiveNav(navTracker);
    };

    navProfile.onclick = () => {
        switchPage(profilePage);
        updateActiveNav(navProfile);
    };
    
    // --- Splash Screen Logic ---
    function initializeWelcomeSequence() {
        setTimeout(() => {
            if(loader) loader.style.display = 'block';
            setTimeout(() => {
                if(loader) loader.style.display = 'none';
                if(startButton) startButton.style.display = 'block';
            }, 3000); 
        }, 2000);
    }

    function proceedToDashboardSelection() {
        if (splashScreen) {
            splashScreen.style.opacity = '0';
            splashScreen.style.visibility = 'hidden';
        }
        if (dashboardSelectionScreen) {
            dashboardSelectionScreen.style.display = 'flex';
        }
    }

    if (startButton) {
        startButton.onclick = proceedToDashboardSelection;
    }

    if (patientDashboardButton) {
        patientDashboardButton.onclick = function() {
            if (dashboardSelectionScreen) {
                dashboardSelectionScreen.style.display = 'none';
            }
            switchPage(homePage);
            updateActiveNav(navHome);
            document.body.style.overflow = 'auto';
        }
    }
    
    // --- 3D Model Setup ---
    function setup3DModel() {
        const canvas = document.getElementById('model-canvas');
        if (!canvas) return;

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
        camera.position.set(0, 1.2, 2.5); /* Camera moved closer to make character bigger */

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        
        const ambientLight = new THREE.AmbientLight(0xffffff, 1.5);
        scene.add(ambientLight);
        const directionalLight = new THREE.DirectionalLight(0xffffff, 2);
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.enableZoom = false;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 2.0;
        controls.target.set(0, 0.9, 0);

        const gltfLoader = new GLTFLoader();
        // Assuming 'doctor_-_sketchfab_weekly_-_13_mar23.glb' is also in the 'image' folder
        gltfLoader.load('image/doctor_-_sketchfab_weekly_-_13_mar23.glb', (gltf) => {
            const model = gltf.scene;
            const box = new THREE.Box3().setFromObject(model);
            const center = box.getCenter(new THREE.Vector3());
            model.position.sub(center);
            scene.add(model);
        }, undefined, (error) => console.error(error));

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();
        
        window.addEventListener('resize', () => {
            const card = canvas.parentElement;
            camera.aspect = card.clientWidth / card.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(card.clientWidth, card.clientHeight);
        });
    }
    
    // --- Side Menu Logic ---
    window.showSideMenu = function() {
        if (sideMenu) {
            sideMenu.classList.add('open');
            const overlay = document.createElement('div');
            overlay.id = 'menu-overlay';
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999;';
            overlay.onclick = hideSideMenu;
            document.body.appendChild(overlay);
        }
    }

    window.hideSideMenu = function() {
        if (sideMenu) {
            sideMenu.classList.remove('open');
            const overlay = document.getElementById('menu-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
    }

    // --- Back Button Function for Prediction/Info/Edit Profile/Wallet Pages ---
    window.goBackToTracker = function() {
        switchPage(trackerPage);
        updateActiveNav(navTracker);
    }

    window.goBackToProfile = function() {
        switchPage(profilePage);
        updateActiveNav(navProfile);
    }

    // --- Draggable Medical Assistant Button ---
    if (medicalAssistantFloat) {
        let isDragging = false;
        let currentX;
        let currentY;
        let initialX;
        let initialY;
        let xOffset = 0;
        let yOffset = 0;

        medicalAssistantFloat.addEventListener("touchstart", dragStart, false);
        medicalAssistantFloat.addEventListener("touchend", dragEnd, false);
        medicalAssistantFloat.addEventListener("touchmove", drag, false);

        medicalAssistantFloat.addEventListener("mousedown", dragStart, false);
        medicalAssistantFloat.addEventListener("mouseup", dragEnd, false);
        medicalAssistantFloat.addEventListener("mousemove", drag, false);

        function dragStart(e) {
            if (e.type === "touchstart") {
                initialX = e.touches[0].clientX - xOffset;
                initialY = e.touches[0].clientY - yOffset;
            } else {
                initialX = e.clientX - xOffset;
                initialY = e.clientY - yOffset;
            }

            if (e.target === medicalAssistantFloat || medicalAssistantFloat.contains(e.target)) {
                isDragging = true;
            }
        }

        function dragEnd(e) {
            initialX = currentX;
            initialY = currentY;
            isDragging = false;
        }

        function drag(e) {
            if (isDragging) {
                e.preventDefault();

                if (e.type === "touchmove") {
                    currentX = e.touches[0].clientX - initialX;
                    currentY = e.touches[0].clientY - initialY;
                } else {
                    currentX = e.clientX - initialX;
                    currentY = e.clientY - initialY;
                }

                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, medicalAssistantFloat);
            }
        }

        function setTranslate(xPos, yPos, el) {
            el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
        }
    }

    // --- Profile Image Upload and Local Storage ---
    function loadProfileImage() {
        const savedImage = localStorage.getItem('profileImage');
        if (savedImage) {
            profilePictureImg.src = savedImage;
            profilePictureImg.style.display = 'block';
            profilePicturePlaceholder.style.display = 'none';
        } else {
            profilePictureImg.style.display = 'none';
            profilePicturePlaceholder.style.display = 'block';
        }
    }

    if (profilePictureInput) {
        profilePictureInput.addEventListener('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageDataUrl = e.target.result;
                    localStorage.setItem('profileImage', imageDataUrl);
                    loadProfileImage(); // Reload to display the new image
                };
                reader.readAsDataURL(file);
            }
        });
    }

    // --- Profile Page Functions ---
    window.showEditProfile = function() {
        if (!currentUserId) {
            alert("User not logged in. Please wait for authentication.");
            return;
        }
        loadUserData(); // Load current profile data into form
        switchPage(editProfilePage);
    };

    window.saveUserProfile = async function() {
        if (!currentUserId) {
            alert("User not logged in. Cannot save profile.");
            return;
        }

        const name = profileNameInput.value.trim();
        const mobile = profileMobileInput.value.trim();
        const address = profileAddressInput.value.trim();
        const email = profileEmailInput.value.trim(); // Email might be read-only, but include for completeness

        if (!name || !mobile || !address || !email) {
            alert("Please fill in all profile fields.");
            return;
        }

        try {
            const userProfileRef = ref(db, 'users/' + currentUserId + '/profile');
            await set(userProfileRef, {
                name: name,
                mobile: mobile,
                address: address,
                email: email
            });
            alert("Profile saved successfully!");
            goBackToProfile(); // Go back to profile display
        } catch (error) {
            console.error("Error saving profile:", error);
            alert("Failed to save profile: " + error.message);
        }
    };

    // --- Wallet Page Functions ---
    window.showWalletPage = function() {
        if (!currentUserId) {
            alert("User not logged in. Please wait for authentication.");
            return;
        }
        loadCoinBalance(); // Ensure latest balance is loaded
        switchPage(walletPage);
    };

    window.buyCoins = async function(coinsToAdd, amountInPaise) {
        if (!currentUserId) {
            alert("User not logged in. Cannot process payment.");
            return;
        }

        // IMPORTANT: In a production app, the order creation MUST happen on your backend.
        // This is a simplified client-side example for demonstration.
        // For secure Razorpay integration, your 'server.js' should handle:
        // 1. Creating a Razorpay order: POST to /create-razorpay-order which returns an order_id.
        // 2. Verifying the payment signature after success: POST to /verify-razorpay-payment.
        // The RAZORPAY_KEY_SECRET MUST NEVER BE EXPOSED ON THE CLIENT-SIDE.

        // Placeholder for Razorpay Key ID (replace with your actual public Key ID)
        // This should ideally be fetched from your server or a public config.
        const razorpayKeyId = 'rzp_test_e7N2tXN0e0eJ6i'; // Replace with your actual Key ID for testing/development

        try {
            // Step 1: Create an order on your backend (simulated for demonstration)
            // Replace this with an actual fetch to your server.js endpoint
            const orderResponse = await fetch('/create-razorpay-order', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ amount: amountInPaise, currency: 'INR', userId: currentUserId }),
            });
            const orderData = await orderResponse.json();

            if (!orderResponse.ok || !orderData.order_id) {
                alert('Failed to create Razorpay order: ' + (orderData.message || 'Unknown error'));
                return;
            }

            const options = {
                key: razorpayKeyId, // Your Key ID
                amount: amountInPaise, // Amount is in currency subunits.
                currency: "INR",
                name: "Shubhmed",
                description: `Purchase ${coinsToAdd} Coins`,
                order_id: orderData.order_id, // This is the order ID created on your backend
                handler: async function (response) {
                    // Step 2: Verify payment signature on your backend
                    // Replace this with an actual fetch to your server.js endpoint
                    const verifyResponse = await fetch('/verify-razorpay-payment', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_signature: response.razorpay_signature,
                            userId: currentUserId,
                            coinsToAdd: coinsToAdd // Pass coins to add to backend for atomic update
                        }),
                    });
                    const verifyData = await verifyResponse.json();

                    if (verifyResponse.ok && verifyData.success) {
                        alert(`Payment successful! You received ${coinsToAdd} coins.`);
                        // Coin balance will be updated by Firebase listener from loadCoinBalance()
                        // if your backend successfully updates it after verification.
                    } else {
                        alert('Payment verification failed: ' + (verifyData.message || 'Unknown error'));
                    }
                },
                prefill: {
                    name: profileNameInput.value || "",
                    email: profileEmailInput.value || "",
                    contact: profileMobileInput.value || ""
                },
                theme: {
                    color: "#008CBA"
                }
            };
            const rzp1 = new Razorpay(options);
            rzp1.on('payment.failed', function (response){
                alert('Payment Failed: ' + response.error.description);
                console.error('Razorpay Payment Failed:', response.error);
            });
            rzp1.open();

        } catch (error) {
            console.error("Error during coin purchase:", error);
            alert("Could not initiate payment. Please try again later.");
        }
    };


    // --- Global Functions (Keep existing ones as requested) ---
    window.showFuturePlan = function() {
        alert('Future plan');
    }

    window.logOut = async function() {
        // Clear profile image from local storage on logout
        localStorage.removeItem('profileImage');
        profilePictureImg.src = ''; // Clear image from display
        profilePictureImg.style.display = 'none';
        profilePicturePlaceholder.style.display = 'block';

        try {
            await auth.signOut();
            alert('Logged out successfully!');
            // Optionally redirect to login or splash screen
            switchPage(splashScreen);
            // Reset nav active state if returning to splash
            updateActiveNav(null); 
            currentUserId = null; // Clear user ID
            currentCoinBalance = 0; // Reset coin balance
            updateCoinDisplays(); // Update displays to 0 or default
        } catch (error) {
            console.error("Error logging out:", error);
            alert("Failed to log out: " + error.message);
        }
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        setup3DModel();
        initializeWelcomeSequence();
        loadProfileImage(); // Load profile image on startup

        // Attach event listeners for tracker buttons
        document.querySelectorAll('.tracker-btn').forEach(button => {
            button.addEventListener('click', async () => {
                const targetPage = button.getAttribute('data-target-page');
                const featureCost = parseInt(button.getAttribute('data-feature-cost') || '0', 10);
                const featureName = button.getAttribute('data-feature-name') || 'this feature';

                if (featureCost > 0) {
                    const confirmUse = confirm(`Using "${featureName}" costs ${featureCost} coin(s). Do you want to proceed?`);
                    if (!confirmUse) {
                        return; // User cancelled
                    }

                    const consumed = await consumeCoin(featureCost);
                    if (!consumed) {
                        return; // Not enough coins or error
                    }
                }
                
                // Proceed only if coins were not required or successfully consumed
                if (targetPage === 'disease-prediction') {
                    switchPage(diseasePredictionPage);
                } else if (targetPage === 'disease-info') {
                    switchPage(diseaseInfoPage);
                } else if (targetPage.startsWith('showFuturePlan')) {
                    showFuturePlan(); // Default for other buttons if no specific page
                }
            });
        });

        // Initial coin display update in case Firebase takes time
        updateCoinDisplays();
    });

</script>

</body>
</html>
